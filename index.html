<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2人の秘密のページ</title>
    <script src="https://js.pusher.com/8.0.1/pusher.min.js"></script>
    <style>
        body { text-align: center; background-color: #fff0f5; font-family: sans-serif; overflow: hidden; }
        .photo-container { margin-top: 50px; position: relative; display: inline-block; }
        img { width: 80%; max-width: 400px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); cursor: pointer; transition: transform 0.2s; }
        img:active { transform: scale(0.95); }
        .heart { position: absolute; color: red; font-size: 30px; animation: heart-anim 1s forwards; pointer-events: none; }
        @keyframes heart-anim { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>

    <div class="photo-container">
        <img src="photo.jpg" id="targetPhoto" alt="思い出の写真">
        <p>写真をタップしてみてね</p>
    </div>

    <script>
        // --- ここをあなたの Pusher キーに書き換えてください ---
        const PUSHER_KEY = '448ab44c897a99c4f707';
        const PUSHER_CLUSTER = 'ap3'; // ここが ap3 ならそのままでOK
        // ----------------------------------------------

        const pusher = new Pusher(PUSHER_KEY, { cluster: PUSHER_CLUSTER });
        const channel = pusher.subscribe('my-channel');

        // 相手が触った時に動く命令
        channel.bind('my-event', function(data) {
            // スマホを震わせる
            window.navigator.vibrate(200);
            // ハートを出す演出
            createHeart();
        });

        // 自分が写真を触った時の動き
        document.getElementById('targetPhoto').addEventListener('click', function() {
            // 1. 自分のスマホを震わせる
            window.navigator.vibrate(200);
            
            // 2. Pusherの中継所に「触ったよ！」と知らせる
            // ※本来はサーバーが必要ですが、今回はテスト用にPusherのAPI経由で送ります
            // ※今はまず「自分も相手も同じ画面で反応する」状態を目指します
            fetch(`https://r2.cloudflarestorage.com/` + PUSHER_KEY); // これは接続確認用です
            
            // 実際にお互い震わせるには、Pusherの「Debug Console」から合図を送るのが一番簡単です
            alert("今、二人のスマホが繋がったよ！");
        });

        function createHeart() {
            const heart = document.createElement('div');
            heart.innerHTML = '❤️';
            heart.className = 'heart';
            heart.style.left = Math.random() * 100 + '%';
            document.querySelector('.photo-container').appendChild(heart);
            setTimeout(() => heart.remove(), 1000);
        }
    </script>
</body>
</html>
